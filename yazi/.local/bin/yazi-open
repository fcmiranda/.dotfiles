#!/usr/bin/env zsh
# Wrapper to run yazi from a window manager and keep terminal open at final cwd.
# Usage: yazi-open [yazi-args]
#
# Note: For interactive shell usage, use the `y` function instead (defined in
# ~/.zsh/packages/yazi.zsh) which is faster and changes the current shell's directory.

set -euo pipefail

tmpfile=$(mktemp -t yazi-cwd.XXXXXX)
trap 'rm -f "$tmpfile"' EXIT

yazi "$@" --cwd-file="$tmpfile"

# Read cwd and cd if valid
if [[ -s "$tmpfile" ]]; then
  cwd=$(<"$tmpfile")
  [[ -n "$cwd" && -d "$cwd" ]] && cd "$cwd"
fi

# Keep terminal open with interactive shell at final directory
exec "${SHELL:-/bin/zsh}" -i
